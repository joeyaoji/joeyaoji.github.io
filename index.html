<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yahoo OpenID Connect Example</title>
  <script src="js/jquery-2.1.4.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
  <style type="text/css">
    header, section, footer, aside, nav, article, figure, audio, video, canvas  { display:block; }
  </style>
</head>
<body>
  <div class="container">
  <section id="navigation">
    <header><h1>Yahoo OpenID Connect Example</h1></header>
    <nav id="stepTabs"> 
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#intro" aria-controls="intro" role="tab" data-toggle="tab">Intro</a></li>
        <li role="presentation"><a href="#step1" aria-controls="step1" role="tab" data-toggle="tab">Step 1</a></li>
        <li role="presentation"><a href="#step2" aria-controls="step2" role="tab" data-toggle="tab">Step 2</a></li>
        <li role="presentation"><a href="#step3" aria-controls="step3" role="tab" data-toggle="tab">Step 3</a></li>
        <li role="presentation"><a href="#step4" aria-controls="step4" role="tab" data-toggle="tab">Step 4</a></li>
      </ul>
    </nav>
   </section>
   <section class="tab-content panel panel-default">
      <article id="intro" role="tabpanel" class="tab-pane active panel-body" id="intro">
        <header><h2>Welcome to the Yahoo OpenID Connect Tutorial</h2></header>
        <p>We'll be going through three steps to complete the authentication.</p>
         <p><button class="btn btn-default" type="button" id="start_button">Let's Get Started</button></p>

        <div class="progress bottom">
           <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="width: 5%">
             <span class="sr-only">5% Complete</span>
           </div>
         </div>
      </article>
      <article id="step1" role="tabpanel" class="tab-pane panel-body">
        <header><h2>Step 1: Create Application</h2></header>
        <ol>
          <li><a href="https://developer.yahoo.com/apps/create/">Create a YDN application</a></li>
          <li>Use the following callback URL <code>https://openid-connect.herokuapp.com</code>.
              <p>Once you've created your application, you will be given a
                 Consumer Key and Consumer Secret. We'll be using these in 
                 the next step.</p>
          </li>
          <li>Great, I have my app! What next?<br/>
              <p><button onclick="" class="btn btn-default" type="button" id="step1_button">Let's Go to Step 2!</button></p>
          </li>
        </ol>
         <div class="progress">
           <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
             <span class="sr-only">25% Complete</span>
           </div>
         </div>
      </article>
      <article id="step2" role="tabpanel" class="tab-pane panel-body">
        <header><h2>Step 2: Create Auth URL</h2></header>
        <p>Enter your Consumer Key in the field below:</p>
        <p>
          <label for="client_id">Consumer Key</label>
          <input type="text" inputmode="verbatim" name="client_id" placeholder="" required="required" id="client_id" /> <br/>
       </p>
       <div id="auth_url_div"></div>
       <p><button onclick="" class="btn btn-default" type="button" id="auth_url" data-toggle="tooltip" title="Please enter both your Client ID and Client Secret.">Create Auth URL</button></p>
       <span id="auth_url_text"></span>
       <p>You'll be taken to the Yahoo <b>Consent Screen</b>, and after you click **Accept**, you'll
          be taken back here.</p>
        <div class="progress">
         <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100" style="width: 50%">
           <span class="sr-only">50% Complete</span>
         </div>
        </div>
      </article> 
      <article id="step3" role="tabpanel" class="tab-pane">
        <header><h2>Step 3: Get ID Token</h2></header>
        <p>You'll see the Token ID in the URL path. It's a URL fragment that starts with a hash.</p>
        <p>Here's the ID Token formatted for you:</p>
        <p>
           <textarea id="id_token" cols="600" rows="10">
           </textarea>
       </p>
         <p><button class="btn btn-default" type="button" id="decode_token">Let's Decode the ID Token</button></p>
       <div class="progress">
         <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 75%">
           <span class="sr-only">75% Complete</span>
         </div>
       </div>
     </article> 
     <article id="step4" role="tabpanel" class="tab-pane">
        <header><h2>Step 4: Decode ID Token</h2></header>
        <p>
         <ol>
          <li>The ID Token in it's raw form:
        <p>
           <textarea id="id_token_raw" cols="200" rows="20">
           </textarea>
       </p>
       </li>
       <li>The ID Token is in the following format: <pre>Base64(JOSE header).Base64(Payload).Base64(Signature)</pre>
         <p><button class="btn btn-default" type="button" id="decode_raw_token">Decode the Raw Token</button></p>
          <p>
           <textarea id="id_token_decoded" cols="200" rows="10">
           </textarea>
          </p>
        </li>
       </ol>
       </p>
       <div class="progress">
         <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
           <span class="sr-only">100% Complete</span>
         </div>
       </div>
     </article>
   </section>  
    <footer class="navbar navbar-default navbar-fixed-bottom"> 
      <div class="container">
        <ul id="navlist">
          <li class="navbar-text"><span class="glyphicon glyphicon-asterisk" aria-hidden="true"></span><a href="http://developer.yahoo.com">YDN</a></li>
          <li class="navbar-text"><span class="glyphicon glyphicon-asterisk" aria-hidden="true"></span><a href="openid.net/connect/">OpenID Connect Core Specification</a></li>
        </ul>
      </div>
    </footer>
  </div>   
  <script>
    $( document ).ready(function() {
      var currentURL = window.location.href;
      var uri_components = currentURL.split("#"); 
      if (uri_components.length>1) {
         $('#stepTabs a[href="#step3"]').tab('show');
         var token = "#" + uri_components[1];
         var parts = token.split("&"); 
         var id_token = parts[0];
         var parts_string = parts.join("\n"); 
         $('#id_token').html(parts_string); 
          
         $("#decode_token").click(function (e) {
           e.preventDefault();
           $('#stepTabs a[href="#step4"]').tab('show');
           $('#id_token_raw').html(id_token);
         }); 
         $("#decode_raw_token").click(function (e) {
            token_param = id_token.split('=')
            token_str = token_param[1] 
            decoded_id_token = atob(token_str[0]) + atob(token_str[1]) + atob(token_str[2]);
           $('#id_token_decoded').html(decoded_id_token);
         });
      } else {
         $('#stepTabs a').click(function (e) {
           e.preventDefault()
           $(this).tab('show')
         });
         $("#start_button").click(function (e) {
           e.preventDefault();
           $('#stepTabs a[href="#step1"]').tab('show');
         });
         $("#step1_button").click(function (e) {
           e.preventDefault();
           $('#stepTabs a[href="#step2"]').tab('show');
         });
         $("#auth_url").click(function (e) {
            e.preventDefault();
            ck = $('#client_id').val();
            if (ck) {
               auth_url = "https://api.login.yahoo.com/oauth2/request_auth?client_id=" + ck + "&response_type=id_token&redirect_uri=https://openid-connect.herokuapp.com&scope=openid,mail-r&nonce=12345";            
               auth_url_link = "<a href='" + auth_url + "'>" + auth_url + "</a>";
               $("#auth_url_text").html(auth_url_link);
            } else {
              $(this).popover('show');
            } 
         });
      }
   });
  </script>
  </div>
</body>
</html>
